FROM node:20-alpine

# Set working directory
WORKDIR /app

# Copy package files
COPY package*.json ./

# Install dependencies
RUN npm ci

# Copy project files
COPY . .

# Expose port
# 1. Build the static files
# Inject configuration at build time
ARG VITE_API_URL="http://127.0.0.1:8000/api"
ARG VITE_FIREBASE_API_KEY="AIzaSyDcxs8Fr_MVhVt1OzkSt2k-P6lhgtS-y5Q"
ARG VITE_FIREBASE_AUTH_DOMAIN="arth-neeti.firebaseapp.com"
ARG VITE_FIREBASE_PROJECT_ID="arth-neeti"
ARG VITE_FIREBASE_STORAGE_BUCKET="arth-neeti.firebasestorage.app"
ARG VITE_FIREBASE_MESSAGING_SENDER_ID="83468787277"
ARG VITE_FIREBASE_APP_ID="1:83468787277:web:c2f2728232ffc072044604"
ARG VITE_FIREBASE_MEASUREMENT_ID="G-TM4BDCJ64Y"

ENV VITE_API_URL=$VITE_API_URL \
    VITE_FIREBASE_API_KEY=$VITE_FIREBASE_API_KEY \
    VITE_FIREBASE_AUTH_DOMAIN=$VITE_FIREBASE_AUTH_DOMAIN \
    VITE_FIREBASE_PROJECT_ID=$VITE_FIREBASE_PROJECT_ID \
    VITE_FIREBASE_STORAGE_BUCKET=$VITE_FIREBASE_STORAGE_BUCKET \
    VITE_FIREBASE_MESSAGING_SENDER_ID=$VITE_FIREBASE_MESSAGING_SENDER_ID \
    VITE_FIREBASE_APP_ID=$VITE_FIREBASE_APP_ID \
    VITE_FIREBASE_MEASUREMENT_ID=$VITE_FIREBASE_MEASUREMENT_ID

RUN npm run build

# 2. Install a simple static file server
RUN npm install -g serve

EXPOSE 5173

# 3. Serve the 'dist' folder
CMD ["serve", "-s", "dist", "-l", "5173"]
